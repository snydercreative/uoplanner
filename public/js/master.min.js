"use strict";var namespacer=function(e){var t=e.split("."),l=window;if(t.length)for(var a=0;a<t.length;a++){var n=t[a];void 0===l[n]&&(l[n]={}),l=l[n]}},skillsApp=angular.module("skillsApp",[]);skillsApp.controller("BuildCtrl",["templateService","skillListService","naughtyService",function(e,t,l){var a=this,n=0;a.skills=[],a.templateName="",a.urlName="",a.templateId="",a.skillList=[],t.getAll(function(e){a.skillList=e});new Clipboard("#sharing button");angular.element("#sharing button").on("click",function(e){var t=angular.element(e.currentTarget);t.text("Copied!").animate({top:"-50px",opacity:0},250,function(){t.text("Copy").animate({top:0,opacity:1},250)})}),a.setSkillInput=function(e){a.skillName=e.skill,angular.element(".skill-modal .skill-list").slideUp(250)},a.displaySkillList=function(){angular.element(".skill-modal .skill-list").slideDown(250)},a.displayAddSkillModal=function(){a.skillName="",angular.element(".skill-modal").closest(".modal-wrapper").addClass("active")},a.displayTemplateNameModal=function(){angular.element(".name-modal").closest(".modal-wrapper").addClass("active")},a.dismissModal=function(){angular.element(".modal-wrapper.active").removeClass("active")},a.removeSkill=function(e){var t=angular.element(e.currentTarget),l=t.closest("tr"),i=t.attr("data-skill-name"),o=1*t.attr("data-skill-value");n-=o;for(var s=0;s<a.skills.length;s++)if(a.skills[s].name===i)return a.skills.splice(s,1),void l.detach()},a.addSkill=function(e){if(n+e.value>700)return void i("This would put you over the skill cap.",!0);if(!e.name||0===e.value)return void i("You must select a skill and set a value greater than 0.",!0);if(-1===a.skillList.indexOf(e.name))return void i("Please pick an actual UO skill.",!0);for(var t=0;t<a.skills.length;t++)if(a.skills[t].name===e.name)return void i("You already have that skill.",!0);a.skills.push(e),n+=e.value,angular.element(".skill-modal .skill-list").slideUp(250),a.dismissModal(),i("Your template has unsaved changes.")},a.setTemplateName=function(e){if(s(e)){e.toLowerCase().trim().replace(/\s/g,"_").replace(/\W/g,"").replace(/_/g,"-").replace(/--/g,"-")?(a.templateName=e,angular.element("#templateName").text(e),a.dismissModal(),i("Your template has unsaved changes.")):i("You must set a valid template name",!0)}else i("Please pick a different name. You know why.",!0)},a.saveTemplate=function(){a.templateName&&a.skills.length?e.save(a.skills,a.templateName,"",function(e){a.templateId=e.templateId,a.urlName=e.urlName,i("Skill template saved!"),o(a.templateId,a.urlName)}):i("You must set a template name and add skills to save.",!1)};var i=function(e,t){var l=t?".panel > .modal-warning":"body > .warning",a=angular.element(l);a.find("p").text(e),a.slideDown(250,function(){setTimeout(function(){a.slideUp(250)},1500)})},o=function(e,t){var l=window.location.origin+"/share/"+e+"/"+t;angular.element("#sharing .link").removeClass("inactive").text(l),angular.element("#sharing button").show()},s=function(e){return l.isNaughty(e)}}]),skillsApp.controller("HomeCtrl",["$http",function(e){var t=this;t.recentData=[],e.get("/api/v1/template/recent").then(function(e){t.recentData=l(e.data)},function(e){console.log(e)});var l=function(e){for(var t=0;t<e.length;t++){var l=new Date(e[t].lastModified);e[t].lastModified=l.toLocaleDateString()+" @ "+l.toLocaleTimeString(),e[t].url="/share/"+e[t].templateId+"/"+e[t].urlName}return e}}]),skillsApp.controller("ShareCtrl",["templateService","$location","$scope",function(e,t,l){var a=this;a.templateId=encodeURIComponent(window.location.pathname.split("/")[2]),a.urlName=encodeURIComponent(window.location.pathname.split("/")[3]),a.shareUrl=window.location.origin+"/share/"+a.templateId+"/"+a.urlName,e.get(a.templateId,a.urlName,function(e){a.skills=e.skills,a.templateName=e.name}),angular.element("#sharing button").on("click",function(e){var t=angular.element(e.currentTarget);t.text("Copied!").animate({top:"-20px",opacity:0},250,function(){setTimeout(function(){t.text("Copy").animate({top:0,opacity:1},250)},500)})})}]),skillsApp.factory("naughtyService",["$http",function(e){return{isNaughty:function(t,l){e.get("/api/v1/template/naughty/"+t).then(function(e){l(e.data)},function(e){console.log(e)})}}}]),skillsApp.factory("skillListService",["$http",function(e){return{getAll:function(t){e.get("/data/skills.json").then(function(e){t(e.data.skills)},function(e){console.log(e)})}}}]),skillsApp.factory("templateService",["$http",function(e){return{save:function(t,l,a,n){var i={skills:t,templateName:l,templateId:a};e.post("/api/v1/template/save",i).then(function(e){n(e.data)},function(e){console.log(e)})},get:function(t,l,a){e.get("/api/v1/template/get/"+t+"/"+l).then(function(e){a(e.data)},function(e){console.log(e)})}}}]);