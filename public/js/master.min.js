"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var l=0,t=Array(e.length);l<e.length;l++)t[l]=e[l];return t}return Array.from(e)}function _defineProperty(e,l,t){return l in e?Object.defineProperty(e,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[l]=t,e}var namespacer=function(e){var l=e.split("."),t=window;if(l.length)for(var a=0;a<l.length;a++){var n=l[a];void 0===t[n]&&(t[n]={}),t=t[n]}};namespacer("uoplanner"),uoplanner.ruleManager=function(){var e={ruleSet:"Renaissance",skillMax:100,skillTotal:700},l={ruleSet:"Outlands",skillMax:120,skillTotal:720};return{getRules:function(){if(localStorage){var e=localStorage.uoplannerRules;try{return e&&JSON.parse(e)}catch(e){return console.error(e),{}}}console.log("No localStorage.")},setRules:function(t){if(localStorage)try{return localStorage.uoplannerRules="Renaissance"===t?JSON.stringify(e):JSON.stringify(l),!0}catch(e){return console.error("Error parsing settings form localStorage."),!1}console.error("No localStorage.")}}}(),namespacer("uoplanner"),uoplanner.skillSorter=function(){return{sort:function(e){return e.sort(function(e,l){return e.name>l.name?1:e.name<l.name?-1:0}),e.sort(function(e,l){return e.value>l.value?-1:e.value<l.value?1:0}),e}}}(),namespacer("uoplanner"),uoplanner.hamburgerMenu=function(e,l){var t=function(l){e("#template-search-modal").addClass("active")},a=function(e){window.location.href="/build"},n=function(l){e("#template-search-modal").removeClass("active")};return{init:function(){e(".hamburger-menu button.search").on("click",t),e(".hamburger-menu button.create").on("click",a),e(".modal-wrapper.search .close").on("click",n)}}}(jQuery),$(function(){uoplanner.hamburgerMenu.init()});var skillsApp=angular.module("skillsApp",["ngTagsInput"]).config(["$locationProvider",function(e){e.html5Mode({enabled:!0,requireBase:!1})}]);skillsApp.controller("BuildCtrl",["$scope","$location","templateService","skillListService","naughtyService",function(e,l,t,a,n){var i=this;i.uoplannerRules=uoplanner.ruleManager.getRules(),i.skills=[],i.suggestedSkills=[],i.templateName="",i.skillList=[],i.rangeValue=100,i.skillName="",i.skillTotal=0;var s=window.location.pathname.split("/")[2],r=window.location.pathname.split("/")[3];void 0!==s&&void 0!==r&&(i.templateId=encodeURIComponent(s),i.urlName=encodeURIComponent(r)),i.templateId&&i.urlName&&t.get(i.templateId,i.urlName,function(e){i.skills=uoplanner.skillSorter.sort(e.map(function(e){return e.skill})),i.ruleSet=e.ruleSet,i.skillTotal=i.skills.reduce(function(e,l){return e+l.value},0)}),a.getAll(function(e){i.skillList=e.map(function(e){return e.skill}),i.relatedSkillList=e}),i.changeView=function(e){l.path(e)},i.switchRulesModalButtonClick=function(e){i.switchRules(e),i.dismissModal()},i.switchRules=function(e){uoplanner.ruleManager.setRules(e),i.skillTotal=0,i.skills=[],i.templateName="",i.uoplannerRules=uoplanner.ruleManager.getRules()};new Clipboard("#sharing button");angular.element("#sharing button").on("click",function(e){var l=angular.element(e.currentTarget);l.text("Copied!").animate({top:"-50px",opacity:0},250,function(){l.text("Copy").animate({top:0,opacity:1},250)})}),i.setSkillInput=function(e){i.skillName=e.skill,angular.element(".skill-modal .skill-list").slideUp(250)},i.displaySkillList=function(){angular.element(".skill-modal .skill-list").slideDown(250),angular.element("#skillSearch").focus()},i.displayAddSkillModal=function(){i.skillName="",angular.element("#skills-modal").addClass("active")},i.displayRelatedSkillsModal=function(){angular.element("#related-skills-modal").addClass("active"),angular.element(".skill-modal .skill-list").slideDown(250)},i.displaySwitchRulesModal=function(){i.skillName="",angular.element("#rule-switch-modal").addClass("active")},i.displayTemplateNameModal=function(){angular.element("#template-name-modal").addClass("active")},i.dismissModal=function(){angular.element(".modal-wrapper.active").removeClass("active")},i.editSkill=function(e){var l=i.skills.filter(function(l){return l.name===e});if(l)return i.skillName=l[0].name,i.rangeValue=l[0].value,void angular.element("#skills-modal").addClass("active");o("Skill not found.",!1)},i.removeSkill=function(e){var l=angular.element(e.currentTarget),t=l.closest("tr"),a=l.attr("data-skill-name"),n=1*l.attr("data-skill-value");i.skillTotal-=n;for(var s=0;s<i.skills.length;s++)if(i.skills[s].name===a)return i.skills.splice(s,1),void t.detach()},i.addSkill=function(e){for(var l=-1,t=0;t<i.skills.length;t++)if(i.skills[t].name===e.name){i.skillTotal-=i.skills[t].value,l=t;break}return i.skillTotal+e.value>i.uoplannerRules.skillTotal?void o("This would put you over the skill cap.",!0):e.name&&0!==e.value?-1===i.skillList.indexOf(e.name)?void o("Please pick an actual UO skill.",!0):i.skills[l]?(i.skills[l].value=e.value,i.skillTotal=i.skillTotal?e.value+i.skillTotal:e.value,angular.element(".skill-modal .skill-list").slideUp(250),i.dismissModal(),i.skills=uoplanner.skillSorter.sort(i.skills),void o("Your template has unsaved changes.")):(i.skills.push(e),i.skillTotal+=e.value,i.skills=uoplanner.skillSorter.sort(i.skills),angular.element(".skill-modal .skill-list").slideUp(250),i.dismissModal(),o("Your template has unsaved changes."),i.suggestedSkills=i.findRelatedSkills(e.name),i.suggestedSkills=i.suggestedSkills.filter(function(e){return 0===i.skills.filter(function(l){return l.name===e}).length}),void(i.suggestedSkills.length&&i.displayRelatedSkillsModal())):void o("You must select a skill and set a value greater than 0.",!0)},i.addRelatedSkills=function(e){var l,t=e.map(function(e){return{name:e,value:i.rangeValue}}),a=t.reduce(function(e,l){return e.value+l.value});return i.skillTotal+a>i.uoplannerRules.skillTotal?void o("This would put you over the skill cap.",!0):0===i.rangeValue?void o("You must select a skill and set a value greater than 0.",!0):((l=i.skills).push.apply(l,_toConsumableArray(t)),i.skillTotal+=a,i.skills=uoplanner.skillSorter.sort(i.skills),angular.element(".skill-modal .skill-list").slideUp(250),i.dismissModal(),void o("Your template has unsaved changes."))},i.findRelatedSkills=function(e){var l=i.relatedSkillList.filter(function(l){return l.skill.toLowerCase()===e.toLowerCase()});return l.length&&l[0].hasOwnProperty("related")?l[0].related:[]},i.setTemplateName=function(e){e.toLowerCase().trim().replace(/\s/g,"_").replace(/\W/g,"").replace(/_/g,"-").replace(/--/g,"-")?c(e,function(l){if(l)return void o("Please pick a different name. You know why.",!0);i.templateName=e,angular.element("#templateName").text(e),i.dismissModal(),o("Your template has unsaved changes.")}):o("You must set a valid template name",!0)},i.saveTemplate=function(){i.templateName&&i.skills.length?t.save(i.skills,i.templateName,i.templateId,i.uoplannerRules.ruleSet,function(e){i.templateId=e.templateId,i.urlName=e.urlName,o("Skill template saved!"),u(i.templateId,i.urlName)}):o("You must set a template name and add skills to save.",!1)};var o=function(e,l){var t=l?".panel > .modal-warning":"body > .warning",a=angular.element(t);a.find("p").text(e),a.slideDown(250,function(){setTimeout(function(){a.slideUp(250)},1500)})},u=function(e,l){var t=window.location.origin+"/share/"+e+"/"+l;angular.element("#sharing .link").removeClass("inactive").text(t),angular.element("#sharing button").show()},c=function(e,l){n.isNaughty(e,function(e){l(e.isNaughty)})}}]),skillsApp.factory("naughtyService",["$http",function(e){return{isNaughty:function(l,t){e.get("/api/v1/template/naughty/"+l).then(function(e){t(e.data)},function(e){console.log(e)})}}}]),skillsApp.factory("searchService",["$http","skillListService",function(e,l){return{findSkills:function(l,t){e.get("/api/v1/search/skills?q="+l).then(function(e){t(e.data)},function(e){console.log(e)})},findNames:function(l,t){e.get("/api/v1/search/names?q="+l).then(function(e){t(e.data)},function(e){console.log(e)})}}}]),skillsApp.factory("skillListService",["$http",function(e){return{getAll:function(l){e.get("/data/skills.json").then(function(e){l(e.data)},function(e){console.log(e)})}}}]),skillsApp.factory("templateService",["$http",function(e){return{save:function(l,t,a,n,i){var s=_defineProperty({skills:l,templateName:t,templateId:a,ruleSet:n},"templateId",a);e.post("/api/v1/template/save",s).then(function(e){i(e.data)},function(e){console.log(e)})},get:function(l,t,a){e.get("/api/v1/template/get/"+l+"/"+t).then(function(e){a(e.data)},function(e){console.log(e)})}}}]),skillsApp.controller("HomeCtrl",["$http",function(e){var l=this;l.recentData=[],l.uoplannerRules=uoplanner.ruleManager.getRules(),l.uoplannerRules||uoplanner.ruleManager.setRules(),l.switchRules=function(e){uoplanner.ruleManager.setRules(e),l.uoplannerRules=uoplanner.ruleManager.getRules(),l.recentData=[],t()};var t=function(){l.uoplannerRules=uoplanner.ruleManager.getRules(),e.get("/api/v1/template/recent/"+l.uoplannerRules.ruleSet).then(function(e){l.recentData=t(e.data)},function(e){console.log(e)});var t=function(e){for(var l=0;l<e.length;l++){var t=new Date(e[l].lastModified);e[l].lastModified=t.toLocaleDateString()+" @ "+t.toLocaleTimeString(),e[l].url="/share/"+e[l].templateId+"/"+e[l].urlName}return e}};t()}]),skillsApp.controller("ShareCtrl",["templateService","$location","$scope",function(e,l,t){var a=this;a.templateId=encodeURIComponent(window.location.pathname.split("/")[2]),a.urlName=encodeURIComponent(window.location.pathname.split("/")[3]),a.shareUrl=window.location.origin+"/share/"+a.templateId+"/"+a.urlName,e.get(a.templateId,a.urlName,function(e){a.skills=uoplanner.skillSorter.sort(e.skills),a.templateName=e.name,a.ruleSet=e.ruleSet}),angular.element("#sharing button").on("click",function(e){var l=angular.element(e.currentTarget);l.text("Copied!").animate({top:"-20px",opacity:0},250,function(){setTimeout(function(){l.text("Copy").animate({top:0,opacity:1},250)},500)})})}]),skillsApp.controller("SearchBoxCtrl",["skillListService",function(e){var l=this;l.skillTags=[],e.getAll(function(e){l.skills=e}),l.displaySkillList=function(){angular.element("#template-search-modal .skill-list").slideDown(250)},l.addSkillTag=function(e){-1===l.skillTags.indexOf(e.skill)&&l.skillTags.length<3&&l.skillTags.push(e.skill),l.skillName="",angular.element("#template-search-modal .skill-list").slideUp(250)},l.search=function(){if(l.skillTags.length){var e=l.skillTags.join(",");window.location="/search?q="+e}}}]),skillsApp.controller("SearchCtrl",["$location","searchService","skillListService",function(e,l,t){var a=this;a.searchTerms=e.search().q,a.skillResults=[],a.nameResults=[],l.findSkills(a.searchTerms,function(e){console.log(e),angular.forEach(e,function(e){var l=new Date(e.lastModified);e.lastModified=l.toLocaleDateString()+" @ "+l.toLocaleTimeString()}),a.skillResults=e})}]),skillsApp.directive("rulesetSwitcher",function(){return{templateUrl:"views/rulesetSwitcher/rulesetSwitcher.html",controller:["$scope",function(e){return{changeRuleset:function(e){uoplanner.ruleManager.setRules(e)}}}],controllerAs:"vm"}});
//# sourceMappingURL=master.min.js.map
